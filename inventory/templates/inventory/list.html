{% extends "base.html" %}

{% block title %}在庫{% endblock %}

{% block content %}
<!--
在庫一覧ページ（inventory/list.html）

目的：
- base.html を継承して、全ページ共通のナビ（在庫/メモ/管理/ログアウト）を表示する
- 在庫を一覧表示し、カテゴリ未設定の場合は「未分類」と表示する
- 一覧の先頭に「在庫を追加」リンクを置く
-->

<h1>在庫一覧</h1>
<!-- ----------------------------
カテゴリ絞り込みフォーム
- method="get" にするとURLに ?category= が付く
- selected_category と categories を使ってプルダウンを作る
----------------------------- -->
<form method="get">

  <!-- 分類 -->
  <label>分類</label>
  <select name="category">
    <option value="">すべて</option>
    {% for c in categories %}
      <option value="{{ c.id }}"
        {% if selected_category == c.id|stringformat:"s" %}
          selected
        {% endif %}
      >
        {{ c.name }}
      </option>
    {% endfor %}
  </select>

  <!-- 保管場所（今回追加） -->
  <label>保管場所</label>
  <select name="storage">
    <option value="">すべて</option>
    {% for s in storages %}
      <option value="{{ s.id }}"
        {% if selected_storage == s.id|stringformat:"s" %}
          selected
        {% endif %}
      >
        {{ s.name }}
      </option>
    {% endfor %}
  </select>

  <button class="btn" type="submit">絞り込み</button>

  <!-- 絞り込み解除（categoryパラメータ無しで /inventory/ に戻す） -->
  <a class="btn" href="{% url 'inventory:inventory_list' %}">解除</a>
</form>

<hr>

<!--
一覧の集計表示
- View側で total_items / total_quantity を渡しているのでここで表示できる
-->
<p>
  合計：{{ total_items }}件 / 数量合計：{{ total_quantity }}
</p>

<!-- 在庫追加リンク（urls.py の name="inventory_add" を参照） -->
<p><a href="{% url 'inventory:inventory_add' %}">＋在庫を追加</a></p>

{% for item in object_list %}
  <p>
    <!-- カテゴリ表示：FKなので name を表示（未設定なら未分類） -->
    {% if item.category %}
      【{{ item.category.name }}】
    {% else %}
      【未分類】
    {% endif %}

    {{ item.name }} / {{ item.quantity }}
   
    {% if item.storage_location %}
    （{{ item.storage_location.name }}）
    {% else %}
      （保管場所未設定）
    {% endif %}

    <a href="{% url 'inventory:inventory_edit' item.pk %}">編集</a>
    <a href="{% url 'inventory:inventory_delete' item.pk %}">削除</a>
  </p>

{% empty %}
  <p>在庫がまだありません。</p>
{% endfor %}

{% endblock %}