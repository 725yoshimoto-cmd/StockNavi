{% extends "base.html" %}
{% block title %}åœ¨åº«{% endblock %}
{% block content %}

<h1>åœ¨åº«ä¸€è¦§</h1>

<form method="get">
  <label>åˆ†é¡</label>
  <select name="category">
    <option value="">ã™ã¹ã¦</option>
    {% for c in categories %}
      <option value="{{ c.id }}" {% if selected_category == c.id|stringformat:"s" %}selected{% endif %}>
        {{ c.name }}
      </option>
    {% endfor %}
  </select>

  <label>ä¿ç®¡å ´æ‰€</label>
  <select name="storage">
    <option value="">ã™ã¹ã¦</option>
    {% for s in storages %}
      <option value="{{ s.id }}" {% if selected_storage == s.id|stringformat:"s" %}selected{% endif %}>
        {{ s.name }}
      </option>
    {% endfor %}
  </select>

  <button class="btn" type="submit">çµã‚Šè¾¼ã¿</button>
  <a class="btn" href="{% url 'inventory:inventory_list' %}">è§£é™¤</a>
</form>

<hr>

<p>åˆè¨ˆï¼š{{ total_items }}ä»¶ / æ•°é‡åˆè¨ˆï¼š{{ total_quantity }}</p>
<p><a href="{% url 'inventory:inventory_add' %}">ï¼‹åœ¨åº«ã‚’è¿½åŠ </a></p>

<!--è¦‹ãŸç›®ï¼ˆCSSï¼‰ã¯ã€Œ1å›ã ã‘ã€ã“ã“ã«ç½®ã-->
<style>
  .item-card{
    border:1px solid #ddd;
    border-radius:12px;
    padding:10px 12px;
    margin:10px 0;
    background:#fff;
  }
  .row-top{
    display:flex;
    align-items:center;
    gap:8px;
    flex-wrap:wrap;
    margin-bottom:6px;
  }
  .cat-tag{
    display:inline-block;
    padding:2px 8px;
    border-radius:999px;
    font-size:12px;
    border:1px solid #ddd;
    vertical-align:middle;
  }
  .alert-icon{
    display:inline-block;
    font-size:14px;
    vertical-align:middle;
  }
  .alert-red{ color:#d00; font-weight:700; }
  .alert-blue{ color:#06c; font-weight:700; }
  .item-name{
    font-weight:700;
    font-size:16px;
    line-height:1.2;
  }
  .meta{
    font-size:12px;
    color:#333;
    margin-top:6px;
    display:flex;
    flex-wrap:wrap;
    gap:8px 10px;
  }
  .meta span{
    background:#f7f7f7;
    border:1px solid #eee;
    border-radius:999px;
    padding:2px 8px;
  }
  .actions{
    margin-top:8px;
    display:flex;
    gap:10px;
  }
  .actions a{ font-size:13px; }
</style>

<!--åœ¨åº«ä¸€è¦§ï¼ˆã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼‰-->
{% for item in items %}
  <div class="item-card
      {% if item.is_alert_red %} text-alert-red
      {% elif item.is_alert_blue %} text-alert-blue
      {% endif %}">

    <div class="row-top">
      {% if item.category %}
        <span class="cat-tag" style="background: {{ item.category.color|default:'#f1e8ff' }};">
          {{ item.category.name }}
        </span>
      {% else %}
        <span class="cat-tag" style="background:#eee;">æœªåˆ†é¡</span>
      {% endif %}

      {% if item.is_alert_red %}
        <span class="alert-icon" style="color:#dc3545; font-weight:700;" title="ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆåœ¨åº«0 ã¾ãŸã¯ æœŸé™0æ—¥ï¼‰">ğŸ””</span>
      {% elif item.is_alert_blue %}
        <span class="alert-icon" style="color:#0d6efd; font-weight:700;" title="æ³¨æ„ï¼ˆè¨­å®šã—ãŸå€‹æ•°ãƒ»æœŸé™å†…ï¼‰">ğŸ””</span>
      {% endif %}
      <a href="{% url 'inventory:inventory_detail' item.pk %}" class="item-name">
        {{ item.name }}
      </a>
    </div>

    <div class="meta">
      <span>æ•°é‡ï¼š{{ item.quantity }}</span>

      {% if item.expiry_date %}
        <span>è³å‘³æœŸé™ï¼š{{ item.expiry_date }}</span>
      {% else %}
        <span>è³å‘³æœŸé™ï¼šæœªè¨­å®š</span>
      {% endif %}

      {% if item.days_left is not None %}
        <span>æ®‹ã‚Šï¼š{{ item.days_left }}æ—¥</span>
      {% endif %}

      {% if item.storage_location %}
        <span>ä¿ç®¡ï¼š{{ item.storage_location.name }}</span>
      {% else %}
        <span>ä¿ç®¡ï¼šæœªè¨­å®š</span>
      {% endif %}
    </div>

    <div class="actions">
      <a href="{% url 'inventory:inventory_edit' item.pk %}">ç·¨é›†</a>
      <a href="{% url 'inventory:inventory_delete' item.pk %}">å‰Šé™¤</a>
    </div>

  </div>
{% empty %}
  <p>åœ¨åº«ãŒã‚ã‚Šã¾ã›ã‚“</p>
{% endfor %}

{% endblock %}